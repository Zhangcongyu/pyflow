---
name: projectflow-executor
description: |
  è¯»å– pjflow/versioned/task_plan.mdï¼Œé€é˜¶æ®µæ‰§è¡Œè®¡åˆ’ï¼Œæ›´æ–° progress.md å’Œ CHECKLIST.mdã€‚

  **è§¦å‘æ¡ä»¶**: ç”± projectflow-planner è°ƒç”¨ï¼Œæˆ–ç”¨æˆ·è¯´"ç»§ç»­æ‰§è¡Œ task_plan.md"

  **æ ¸å¿ƒèŒè´£**:
  - æ£€æµ‹ç‰ˆæœ¬ç›®å½•å¹¶è¯»å–å¯¹åº”çš„ task_plan.md
  - æ‰¾åˆ°ä¸‹ä¸€ä¸ª pending çš„ Phase
  - æ ¹æ® Tool å­—æ®µè°ƒç”¨å¯¹åº”çš„å·¥å…·/æŠ€èƒ½/ä»£ç†
  - æ›´æ–° CHECKLIST.md
  - æ›´æ–° progress.md
  - æ ‡è®° Phase ä¸º complete

---

# Projectflow Executor

## ç¼–æ’è€…è¡Œä¸ºå‡†åˆ™

**ä½ æ˜¯ç¼–æ’è€…ï¼ˆORCHESTRATORï¼‰**ï¼š
- âœ… **å¯ä»¥**åˆ›å»ºè„šæ‰‹æ¶ï¼ˆé¡¹ç›®åŸºç¡€è®¾æ–½é…ç½®ï¼‰
- âŒ **ç¦æ­¢**ç¼–å†™ä¸šåŠ¡é€»è¾‘ä»£ç ï¼ˆå¿…é¡»ä½¿ç”¨ TDD å·¥å…·é“¾ï¼‰

### å››æ­¥æ‰§è¡Œæµç¨‹

**æ¯ä¸ª Phase å¿…é¡»ä¸¥æ ¼éµå®ˆ**ï¼š

1. **è°ƒç”¨ tool/skill/agent** â†’ ä½¿ç”¨ Skill/Task/Bash å·¥å…·
2. **ç­‰å¾…å®Œæˆ** â¸ï¸ â†’ æš‚åœæ‰€æœ‰æ“ä½œï¼Œç­‰å¾… tool è¿”å›
3. **éªŒè¯ç»“æœ** âœ“ â†’ æ£€æŸ¥è¾“å‡ºæ˜¯å¦ç¬¦åˆé¢„æœŸ
4. **è®°å½•çŠ¶æ€** ğŸ“ â†’ æ›´æ–°çŠ¶æ€ï¼Œç»§ç»­ä¸‹ä¸€é˜¶æ®µ

### ğŸš¨ ç»å¯¹ç¦æ­¢

- âŒ åœ¨ tool æ‰§è¡ŒæœŸé—´è‡ªå·±å†™ä»£ç 
- âŒ åœ¨ tool æ‰§è¡ŒæœŸé—´è‡ªå·±åˆ›å»ºæ–‡ä»¶
- âŒ è®¤ä¸º"tool å¤ªæ…¢ï¼Œæˆ‘æ¥å¸®å¿™"
- âŒ è·³è¿‡ç­‰å¾…ç›´æ¥è¿›å…¥ä¸‹ä¸€é˜¶æ®µ

### ğŸ’¡ å…³é”®è®¤çŸ¥

ä½ æ˜¯**æŒ‡æŒ¥å®˜**ï¼Œä¸æ˜¯**å£«å…µ**ã€‚ä½ çš„å·¥ä½œæ˜¯å†³å®š"**è°æ¥åš**"ï¼Œä¸æ˜¯"**æ€ä¹ˆåšçš„**"ã€‚

**åˆ¤æ–­æ ‡å‡†**ï¼š
- è¿™æ˜¯è„šæ‰‹æ¶å—ï¼Ÿï¼ˆæ‰€æœ‰é¡¹ç›®éƒ½éœ€è¦ï¼‰ â†’ ä½¿ç”¨ Write å·¥å…· âœ…
- è¿™æ˜¯ä¸šåŠ¡é€»è¾‘å—ï¼Ÿï¼ˆåŒ…å«å…·ä½“åŠŸèƒ½ï¼‰ â†’ ä½¿ç”¨ TDD å·¥å…· âŒ

---

## æ ¸å¿ƒèŒè´£

è¯»å– `./pjflow/task_plan.md`ï¼Œé€é˜¶æ®µæ‰§è¡Œï¼ŒæŒç»­æ›´æ–°çŠ¶æ€ï¼š

```
è¯»å– ./pjflow/task_plan.md
   â†“
æ‰¾åˆ°ä¸‹ä¸€ä¸ª pending çš„ Phase
   â†“
ã€éªŒè¯ã€‘è¯»å–åˆè§„æ–‡æ¡£ (Constitution + Requirements)
   â†“
è°ƒç”¨å¯¹åº”çš„ Toolï¼ˆå¸¦å…¥æ–‡æ¡£ä¸Šä¸‹æ–‡ï¼‰
   â†“
ã€éªŒè¯ã€‘æ£€æŸ¥è¾“å‡ºåˆè§„æ€§
   â†“
æ›´æ–° CHECKLIST.md
æ›´æ–° ./pjflow/progress.md
æ ‡è®° Phase ä¸º complete
   â†“
æ‰€æœ‰ Phase å®Œæˆï¼Ÿ
   â”œâ”€ å¦ â†’ ç»§ç»­ä¸‹ä¸€ä¸ª Phase
   â””â”€ æ˜¯ â†’ æ‰§è¡Œå®Œæˆ
```

## CHECKLIST.md P0 çº§åˆ«æ›´æ–°è¦æ±‚ â­

**åœ¨æ¯ä¸ª Phase å®Œæˆåï¼Œå¿…é¡»æ›´æ–° CHECKLIST.md å¯¹åº”çš„ checkboxï¼**

### æ›´æ–°æ—¶æœº

| Phase | æ›´æ–°æ—¶æœº | æ›´æ–°å†…å®¹ |
|-------|---------|---------|
| **Phase 0** | brainstorming å®Œæˆå | éœ€æ±‚åˆ†æç›¸å…³ checkbox |
| **Phase 1** | constitution åˆ›å»ºå | é¡¹ç›®è§„åˆ™ç›¸å…³ checkbox |
| **Phase 2** | è„šæ‰‹æ¶åˆ›å»ºå | é¡¹ç›®å‡†å¤‡ç›¸å…³ checkbox |
| **Phase 4.1** | RED Phase å®Œæˆå | TDD-RED ç›¸å…³ checkbox |
| **Phase 4.2** | GREEN Phase å®Œæˆå | TDD-GREEN ç›¸å…³ checkbox |
| **Phase 4.3** | REFACTOR Phase å®Œæˆå | TDD-REFACTOR ç›¸å…³ checkbox |
| **Phase 5** | è´¨é‡å®¡æ ¸å®Œæˆå | è´¨é‡å®¡æ ¸å’Œ Git ç›¸å…³ checkbox |

### æ›´æ–°æ–¹æ³•

ä½¿ç”¨ **Edit å·¥å…·** å°† `[ ]` æ›¿æ¢ä¸º `[x]`ï¼š

```python
Edit(
    file_path="CHECKLIST.md",
    old_string="- [ ] Constitution created/updated\n- [ ] Project-specific rules defined",
    new_string="- [x] Constitution created/updated\n- [x] Project-specific rules defined"
)
```

### éªŒè¯ CHECKLIST å·²æ›´æ–°

```bash
# ç¡®è®¤è‡³å°‘æœ‰ä¸€ä¸ª [x] æ ‡è®°
grep -q "\[x\]" CHECKLIST.md && echo "âœ… CHECKLIST å·²æ›´æ–°" || echo "âŒ CHECKLIST æœªæ›´æ–°"

# ç»Ÿè®¡å·²å®Œæˆçš„é¡¹
echo "å·²å®Œæˆ: $(grep '\[x\]' CHECKLIST.md | wc -l) é¡¹"
```

**ğŸš¨ é‡è¦**: è¿™æ˜¯ P0 çº§åˆ«è¦æ±‚ï¼æœªæ›´æ–° CHECKLIST è§†ä¸º Phase æœªå®Œæˆï¼

---

## Phase 4 TDD æ‰§è¡Œå¼ºåˆ¶æ€§æ£€æŸ¥ç‚¹

### æ‰§è¡Œå‰å¼ºåˆ¶æ£€æŸ¥æ¸…å•

**åœ¨å¼€å§‹ Phase 4 ä¹‹å‰ï¼Œå¿…é¡»ç¡®è®¤**ï¼š

```bash
# æ£€æŸ¥æ¸…å•ï¼ˆå¿…é¡»å…¨éƒ¨é€šè¿‡ï¼‰
[ ] æˆ‘æ²¡æœ‰æ‰‹åŠ¨åˆ›å»ºä»»ä½• .py æ–‡ä»¶
[ ] æˆ‘æ²¡æœ‰æ‰‹åŠ¨ç¼–å†™ä»»ä½•ä»£ç 
[ ] æˆ‘å‡†å¤‡è°ƒç”¨å·¥å…·æ¥å®Œæˆ TDD
[ ] æˆ‘ç†è§£ç­‰å¾…å·¥å…·è¿”å›æ˜¯å¿…è¦çš„
```

### æ£€æŸ¥å¤±è´¥å¤„ç†

**å¦‚æœæ£€æŸ¥å¤±è´¥**ï¼š
- âŒ ä½ æ‰‹åŠ¨åˆ›å»ºäº†æ–‡ä»¶ â†’ **ç«‹å³åˆ é™¤**ï¼Œè°ƒç”¨å·¥å…·å®Œæˆ
- âŒ ä½ æƒ³"å¸®å·¥å…·ä¸€æŠŠ" â†’ **ç«‹å³åœæ­¢**ï¼Œè®©å·¥å…·è‡ªå·±å®Œæˆ

**è®°ä½**ï¼šå·¥å…·æ¯”æ‰‹åŠ¨æ›´å¯é ã€æ›´å¿«é€Ÿã€è´¨é‡æ›´é«˜ï¼

---

## Agent è°ƒç”¨å‰å¼ºåˆ¶æ£€æŸ¥æ¸…å•

### Task å·¥å…·å‚æ•°æ ¼å¼

**ğŸš¨ Agent è°ƒç”¨å‰å¼ºåˆ¶æ£€æŸ¥æ¸…å•**ï¼š

```
â–¡ ä½¿ç”¨ Task å·¥å…·ï¼ˆä¸æ˜¯ Skillï¼‰
â–¡ subagent_type åœ¨ç¬¬ä¸€ä½
â–¡ åŒ…å« subjectï¼ˆç®€çŸ­æ ‡é¢˜ï¼Œimperative formï¼‰
â–¡ åŒ…å« descriptionï¼ˆè¯¦ç»†æè¿°ï¼‰
â–¡ åŒ…å« activeFormï¼ˆæ­£åœ¨è¿›è¡Œæ—¶ï¼‰
â–¡ åŒ…å« promptï¼ˆå®Œæ•´ä¸Šä¸‹æ–‡ï¼‰
â–¡ å‚æ•°é¡ºåºç¬¦åˆç¤ºä¾‹æ ¼å¼
```

### âš ï¸ å¸¸è§é”™è¯¯å¯¹ç…§

| âŒ é”™è¯¯ | âœ… æ­£ç¡® | è¯´æ˜ |
|---------|--------|------|
| `description="..."` åœ¨ç¬¬ä¸€ä½ | `subagent_type="..."` åœ¨ç¬¬ä¸€ä½ | å‚æ•°é¡ºåºé‡è¦ |
| æ—  `subject` | `subject="..."` (å¿…éœ€) | å¿…é¡»æœ‰ subject |
| æ—  `activeForm` | `activeForm="..."` (å¿…éœ€) | å¿…é¡»æœ‰ activeForm |
| å‡­è®°å¿†è°ƒç”¨ | å‚è€ƒæœ¬æ–‡æ¡£ | å¿…é¡»éµå®ˆæ ¼å¼ |

---

## æ‰§è¡Œæµç¨‹

### Step 1: æ£€æµ‹ç‰ˆæœ¬ç›®å½•å¹¶è¯»å–å¯¹åº”çš„ task_plan.md

**ç‰ˆæœ¬ç›®å½•ç»“æ„**:
```
pjflow/
â”œâ”€â”€ v0_initial/                    â† æ–°å»ºé¡¹ç›®
â”‚   â””â”€â”€ task_plan.md
â”‚
â”œâ”€â”€ v1_add_percentage/           â† ç¬¬1æ¬¡æ–°å¢åŠŸèƒ½
â”‚   â””â”€â”€ task_plan.md
â”‚
â”œâ”€â”€ v2_add_power_function/       â† ç¬¬2æ¬¡æ–°å¢åŠŸèƒ½
â”‚   â””â”€â”€ task_plan.md
â”‚
â””â”€â”€ vN_add_feature_name/         â† ç¬¬Næ¬¡æ–°å¢åŠŸèƒ½
    â””â”€â”€ task_plan.md
```

**æ£€æµ‹é€»è¾‘**ï¼š
```python
# æ­¥éª¤1ï¼šæ‰«æç‰ˆæœ¬ç›®å½•
import os
from pathlib import Path

pjflow_dir = Path("./pjflow")

# æ‰«ææ‰€æœ‰ç‰ˆæœ¬ç›®å½•
version_dirs = [d for d in pjflow_dir.iterdir() if d.is_dir() and d.name.startswith("v")]

if len(version_dirs) == 0:
    # æ²¡æœ‰ä»»ä½•ç‰ˆæœ¬ç›®å½•ï¼Œå½“å‰åœ¨æ ¹ç›®å½•
    current_plan_path = "./pjflow/task_plan.md"
    current_version = "root"
elif len(version_dirs) == 1:
    # åªæœ‰ä¸€ä¸ªç‰ˆæœ¬ç›®å½•ï¼Œå‡è®¾æ˜¯ v0_initial
    current_plan_path = f"./pjflow/v0_initial/task_plan.md"
    current_version = "v0_initial"
else:
    # æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬å·
    version_numbers = [int(d.name.split("_")[0] for d in version_dirs]
    latest_version = max(version_numbers)
    # è¯»å–æœ€æ–°ç‰ˆæœ¬çš„ task_plan.md
    latest_dir = pjflow_dir / f"v{latest_version}_*"
    current_plan_path = f"{latest_dir}/task_plan.md"
    current_version = f"v{latest_version}"

# åç»­æ­¥éª¤ä½¿ç”¨ current_version å’Œ current_plan_path
print(f"æ£€æµ‹åˆ°ç‰ˆæœ¬ç›®å½•: {current_version}")
print(f"è¯»å–è®¡åˆ’æ–‡ä»¶: {current_plan_path}")
```

**ä½¿ç”¨ Read å·¥å…·è¯»å–æ£€æµ‹åˆ°çš„ task_plan.md**

### Step 2: æ‰¾åˆ°ä¸‹ä¸€ä¸ª pending çš„ Phase

éå†æ‰€æœ‰ Phaseï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª `Status: pending` çš„ Phase

### Step 3: è§£æ Phase ä¿¡æ¯

ä» Phase ä¸­æå–ï¼šDescription, Tool, Tool Type, Args, CHECKLIST, Status

### Step 4: æ›´æ–° Phase çŠ¶æ€ä¸º in_progress

ä½¿ç”¨ **Edit å·¥å…·**å°† Status ä» `pending` æ”¹ä¸º `in_progress`

### Step 4.5: åˆ¤æ–­è„šæ‰‹æ¶ vs ä¸šåŠ¡ç¼–ç 

**åœ¨è°ƒç”¨ä»»ä½• Tool ä¹‹å‰**ï¼Œå¿…é¡»åˆ¤æ–­å½“å‰ Phase æ˜¯å¦å±äºè„šæ‰‹æ¶åˆ›å»ºï¼š

**åˆ¤æ–­æ ‡å‡†**: è¯¦è§ [orchestration-rules.md](references/orchestration-rules.md)

**å…³é”®é—®é¢˜**:
- è¿™æ˜¯è„šæ‰‹æ¶å—ï¼Ÿï¼ˆæ‰€æœ‰é¡¹ç›®éƒ½éœ€è¦ï¼‰ â†’ ä½¿ç”¨ Write å·¥å…· âœ…
- è¿™æ˜¯ä¸šåŠ¡é€»è¾‘å—ï¼Ÿï¼ˆåŒ…å«å…·ä½“åŠŸèƒ½ï¼‰ â†’ ä½¿ç”¨ TDD å·¥å…· âŒ

**ç¤ºä¾‹**:
```
Phase 2 (é¡¹ç›®å‡†å¤‡)     â†’ è„šæ‰‹æ¶ â†’ ä½¿ç”¨ Write å·¥å…· âœ…
Phase 4 (TDD æ‰§è¡Œ)      â†’ ä¸šåŠ¡é€»è¾‘ â†’ ä½¿ç”¨ pyflow-tdd-cycle âŒ
```

---

## ä¼šè¯æ¢å¤

ç”¨æˆ·è¯´ï¼š"ç»§ç»­æ‰§è¡Œ task_plan.md" â†’ è‡ªåŠ¨è¯»å– `./pjflow/task_plan.md`ï¼Œæ‰¾åˆ°ä¸‹ä¸€ä¸ª pending çš„ Phase ç»§ç»­æ‰§è¡Œ

---

## References

### execution-rules.md
Tool è°ƒç”¨æ ¼å¼å’Œ CHECKLIST æ›´æ–°è§„åˆ™çš„è¯¦ç»†è¯´æ˜

### compliance-enforcement.md
åˆè§„æ€§æ‰§è¡Œè§„åˆ™ï¼Œç¡®ä¿ Constitution å’Œ Requirements å¾—åˆ°å…¨ç¨‹éµå®ˆ

### orchestration-rules.md
ç¼–æ’è€…é˜²é”™æŒ‡å—ï¼Œé˜æ˜è„šæ‰‹æ¶åˆ›å»ºä¸ TDD ç¼–ç çš„åŒºåˆ«

### constitution-compliance.md
Constitution åˆè§„æ€§æ£€æŸ¥æŒ‡å—ï¼Œé€‚ç”¨äº Phase 4 (TDD æ‰§è¡Œ) + Phase 5 (è´¨é‡å®¡æ ¸)

### scaffold-creation.md
Phase 2 é¡¹ç›®å‡†å¤‡çš„è¯¦ç»†æ‰§è¡ŒæŒ‡å—

### project-archetypes.md
å¸¸è§ Python é¡¹ç›®ç±»å‹ç›®å½•ç»“æ„å’Œå¿…è¦æ–‡ä»¶

---

**ç‰ˆæœ¬**: 1.3.0
**ç”¨é€”**: ProjectFlow æ¶æ„ - æ‰§è¡Œå™¨
**æ›´æ–°**: æ·»åŠ ç‰ˆæœ¬ç›®å½•æ£€æµ‹ã€å¼•ç”¨å®Œæ•´æ€§

### Step 1: æ£€æµ‹ç‰ˆæœ¬ç›®å½•å¹¶è¯»å–å¯¹åº”çš„ task_plan.md

**ç‰ˆæœ¬ç›®å½•ç»“æ„**:
```
pjflow/
â”œâ”€â”€ v0_initial/                    â† æ–°å»ºé¡¹ç›®
â”‚   â””â”€â”€ task_plan.md
â”‚
â”œâ”€â”€ v1_add_percentage/           â† ç¬¬1æ¬¡æ–°å¢åŠŸèƒ½
â”‚   â””â”€â”€ task_plan.md
â”‚
â”œâ”€â”€ v2_add_power_function/       â† ç¬¬2æ¬¡æ–°å¢åŠŸèƒ½
â”‚   â””â”€â”€ task_plan.md
â”‚
â””â”€â”€ vN_add_feature_name/         â† ç¬¬Næ¬¡æ–°å¢åŠŸèƒ½
    â””â”€â”€ task_plan.md
```

**æ£€æµ‹é€»è¾‘**:
```python
# æ­¥éª¤1ï¼šæ‰«æç‰ˆæœ¬ç›®å½•
import os
from pathlib import Path

pjflow_dir = Path("./pjflow")

# æ‰«ææ‰€æœ‰ç‰ˆæœ¬ç›®å½•
version_dirs = [d for d in pjflow_dir.iterdir() if d.is_dir() and d.name.startswith("v")]

if len(version_dirs) == 0:
    # æ²¡æœ‰ä»»ä½•ç‰ˆæœ¬ç›®å½•ï¼Œå½“å‰åœ¨æ ¹ç›®å½•
    current_plan_path = "./pjflow/task_plan.md"
    current_version = "root"
elif len(version_dirs) == 1:
    # åªæœ‰ä¸€ä¸ªç‰ˆæœ¬ç›®å½•ï¼Œå‡è®¾æ˜¯ v0_initial
    current_plan_path = f"./pjflow/v0_initial/task_plan.md"
    current_version = "v0_initial"
else:
    # æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬å·
    version_numbers = [int(d.name.split("_")[0] for d in version_dirs]
    latest_version = max(version_numbers)
    # è¯»å–æœ€æ–°ç‰ˆæœ¬çš„ task_plan.md
    latest_dir = pjflow_dir / f"v{latest_version}_*"
    current_plan_path = f"{latest_dir}/task_plan.md"
    current_version = f"v{latest_version}"

# åç»­æ­¥éª¤ä½¿ç”¨ current_version å’Œ current_plan_path
print(f"æ£€æµ‹åˆ°ç‰ˆæœ¬ç›®å½•: {current_version}")
print(f"è¯»å–è®¡åˆ’æ–‡ä»¶: {current_plan_path}")
```

**ä½¿ç”¨ Read å·¥å…·è¯»å–æ£€æµ‹åˆ°çš„ task_plan.md**

### Step 2: æ‰¾åˆ°ä¸‹ä¸€ä¸ª pending çš„ Phase

éå†æ‰€æœ‰ Phaseï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª `Status: pending` çš„ Phase

### Step 3: è§£æ Phase ä¿¡æ¯

ä» Phase ä¸­æå–ï¼šDescription, Tool, Tool Type, Args, CHECKLIST, Status

### Step 4: æ›´æ–° Phase çŠ¶æ€ä¸º in_progress

ä½¿ç”¨ **Edit å·¥å…·**å°† Status ä» `pending` æ”¹ä¸º `in_progress`

### Step 4.5: éªŒè¯å‰ç½®æ¡ä»¶ä¸è¯»å–åˆè§„æ–‡æ¡£

